<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ranking Results</title>
    <style>
        #relatedKeywords {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        #relatedKeywords span {
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 5px;
        }

        #loading {
            font-size: 18px;
            color: #666;
            display: none; /* 預設隱藏 */
            text-align: center;
            margin: 20px 0;
        }

        button:disabled {
            background-color: #ccc;
            color: #666;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Ranking Results for <span th:text="${movie}">Movie</span></h1>
    <div id="loading">Loading...</div>
    <div id="results"></div>
    <div id="relatedKeywords">relative word</div>
    <div>
        <button id="prevPage" disabled>last page</button>
        <button id="nextPage">next page</button>
    </div>
    <script>
        let currentPage = 1; // 紀錄目前的頁數
        const movieName = "[[${movie}]]";

        // 初始化載入第一頁結果
        fetchResults(currentPage);

        // 綁定翻頁按鈕事件
        document.getElementById("prevPage").addEventListener("click", () => {
            if (currentPage > 1) {
                currentPage--;
                fetchResults(currentPage);
            }
        });

        document.getElementById("nextPage").addEventListener("click", () => {
            currentPage++;
            fetchResults(currentPage);
        });

        // 發送請求並更新結果
        function fetchResults(page) {
            // 禁用翻頁按鈕並顯示 Loading 提示
            togglePaginationButtons(false);
            document.getElementById("loading").style.display = "block";
            document.getElementById("results").innerHTML = ""; // 清空結果區域

            fetch("/ranked-urls", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ keyword: movieName, page })
            })
            .then(res => res.json())
            .then(data => {
                const results = document.getElementById("results");
                const relatedKeywordsDiv = document.getElementById("relatedKeywords");

                // 清空舊結果
                results.innerHTML = "";
                relatedKeywordsDiv.innerHTML = "<strong>relative word:</strong><br>";

                // 僅顯示排序後的母頁連結
                if (data.siteData) {
                    Object.keys(data.siteData).forEach(url => {
                        const motherPage = document.createElement("div");
                        motherPage.innerHTML = `<a href="${url}" target="_blank">${url}</a>`;
                        results.appendChild(motherPage);
                    });
                } else {
                    results.textContent = "No mother pages found.";
                }

                // 顯示相關關鍵字
                if (data.relatedKeywords && data.relatedKeywords.length > 0) {
                    data.relatedKeywords.forEach(keyword => {
                        const key = keyword.key || "Unknown";
                        const keywordSpan = document.createElement("span");
                        keywordSpan.textContent = key;
                        relatedKeywordsDiv.appendChild(keywordSpan);
                    });
                } else {
                    relatedKeywordsDiv.innerHTML += "No related keywords found.";
                }

                // 隱藏 Loading 提示並啟用翻頁按鈕
                document.getElementById("loading").style.display = "none";
                togglePaginationButtons(true);

                // 更新上一頁按鈕狀態
                document.getElementById("prevPage").disabled = page === 1;
            })
            .catch(error => {
                console.error("Error fetching ranking results:", error);

                // 隱藏 Loading 提示並啟用翻頁按鈕
                document.getElementById("loading").style.display = "none";
                togglePaginationButtons(true);
            });
        }

        // 控制翻頁按鈕的啟用/禁用狀態
        function togglePaginationButtons(enabled) {
            document.getElementById("prevPage").disabled = !enabled;
            document.getElementById("nextPage").disabled = !enabled;
        }
    </script>
</body>
</html>




















